#if canImport(UIKit)
import SwiftUI
import UIKit
public struct HTMLTextView: UIViewRepresentable { public class Coordinator: NSObject, UITextViewDelegate { var onOpenURL: ((URL) -> Void)?; init(onOpenURL: ((URL) -> Void)?) { self.onOpenURL = onOpenURL }; public func textView(_ textView: UITextView, shouldInteractWith URL: URL, in characterRange: NSRange, interaction: UITextItemInteraction) -> Bool { if let onOpenURL { onOpenURL(URL); return false }; return true } } private let html: String; private let linkColor: UIColor; private let font: UIFont; private let textColor: UIColor; private let lineBreakMode: NSLineBreakMode; private let contentInsets: UIEdgeInsets; private let onOpenURL: ((URL) -> Void)?; public init(html: String, font: UIFont = .preferredFont(forTextStyle: .body), textColor: UIColor = .label, linkColor: UIColor = .systemBlue, lineBreakMode: NSLineBreakMode = .byWordWrapping, contentInsets: UIEdgeInsets = .zero, onOpenURL: ((URL) -> Void)? = nil) { self.html = html; self.font = font; self.textColor = textColor; self.linkColor = linkColor; self.lineBreakMode = lineBreakMode; self.contentInsets = contentInsets; self.onOpenURL = onOpenURL } public func makeCoordinator() -> Coordinator { Coordinator(onOpenURL: onOpenURL) } public func makeUIView(context: Context) -> UITextView { let tv = UITextView(); tv.isEditable = false; tv.isScrollEnabled = false; tv.isSelectable = true; tv.backgroundColor = .clear; tv.textContainerInset = contentInsets; tv.textContainer.lineBreakMode = lineBreakMode; tv.delegate = context.coordinator; tv.linkTextAttributes = [.foregroundColor: linkColor]; updateAttributedText(tv); return tv } public func updateUIView(_ uiView: UITextView, context: Context) { updateAttributedText(uiView) } private func updateAttributedText(_ textView: UITextView) { let data = Data(html.utf8); let options: [NSAttributedString.DocumentReadingOptionKey: Any] = [.documentType: NSAttributedString.DocumentType.html, .characterEncoding: String.Encoding.utf8.rawValue]; if let attributed = try? NSMutableAttributedString(data: data, options: options, documentAttributes: nil) { attributed.beginEditing(); attributed.enumerateAttributes(in: NSRange(location: 0, length: attributed.length)) { attrs, range, _ in var attrs = attrs; if attrs[.font] == nil { attrs[.font] = font }; if attrs[.foregroundColor] == nil { attrs[.foregroundColor] = textColor }; attributed.setAttributes(attrs, range: range) }; attributed.endEditing(); textView.attributedText = attributed } else { textView.text = html; textView.font = font; textView.textColor = textColor } } } 
#endif